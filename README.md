# Projet-personnel-Mod-lisation-Financi-re---Pricing-d-Options-Black-Scholes-Monte-Carlo
Tráº£ lá»i tháº³ng luÃ´n cho báº¡n, theo Ä‘Ãºng â€œchuáº©n tháº§y cÃ´ â€“ nhÃ  tuyá»ƒn dá»¥ng â€“ há»c thuáº­tâ€ nhÃ© ğŸ‘‡
âœ… 1. Projet nÃ y cÃ³ thá»±c táº¿ khÃ´ng? â†’ CÃ“. Ráº¤T THá»°C Táº¾.
VÃ¬ nÃ³ dá»±a trÃªn Modern Portfolio Theory â€“ Markowitz, lÃ  ná»n táº£ng cÄƒn báº£n cá»§a:
â€¢	Portfolio management
â€¢	Asset allocation
â€¢	Wealth management
â€¢	Risk management
VÃ  cÃ²n lÃ  ná»n táº£ng cho:
â€¢	Mutual funds
â€¢	ETF allocation
â€¢	Private banking portfolios
ğŸ“Œ Tá»©c lÃ :
ğŸ‘‰ ÄÃ¢y lÃ  1 trong nhá»¯ng mÃ´ hÃ¬nh kinh Ä‘iá»ƒn nháº¥t trong finance, khÃ´ng pháº£i â€œchÆ¡i cho vuiâ€.
ğŸ“Œ HÆ¡n ná»¯a báº¡n dÃ¹ng:
â€¢	dá»¯ liá»‡u tháº­t tá»« Yahoo Finance
â€¢	cá»• phiáº¿u chÃ¢u Ã‚u tháº­t
â€¢	returns tháº­t
â€¢	optimization tháº­t
=> NÃªn vá»«a há»c thuáº­t â€“ vá»«a á»©ng dá»¥ng â€“ vá»«a Ä‘Ãºng chuyÃªn ngÃ nh FE/IEF.
Náº¿u báº¡n trÃ¬nh bÃ y tá»‘t:
â¡ï¸ tháº§y cÃ´ sáº½ Ä‘Ã¡nh giÃ¡ cao
â¡ï¸ ghi CV váº«n â€œá»•n Ã¡pâ€
________________________________________
ğŸ’ª 2. Projet nÃ y cÃ³ máº¡nh khÃ´ng?
MÃ¬nh chia thÃ nh 3 cáº¥p Ä‘á»™:
________________________________________
ğŸ”¹ Level 1 â€” Basic (báº¡n Ä‘ang lÃ m)
â€¢	log-return
â€¢	random portfolios
â€¢	GMV
â€¢	equal weight
â€¢	visualization
ğŸ‘‰ Má»©c nÃ y:
âœ” phÃ¹ há»£p
âœ” dá»… hiá»ƒu
âœ” sáº¡ch sáº½
âœ” logic
ğŸ¯ Äiá»ƒm máº¡nh:
â€¢	náº¯m Ä‘Ãºng cá»‘t lÃµi Markowitz
â€¢	trÃ¡nh overâ€“complication
â€¢	tráº£ lá»i Ä‘Æ°á»£c má»i cÃ¢u há»i cÆ¡ báº£n
âš ï¸ NhÆ°ng:
â†’ chÆ°a â€œráº¥t máº¡nhâ€ náº¿u so vá»›i cÃ¡c báº¡n lÃ m nhiá»u mÃ´ hÃ¬nh hÆ¡n.
MÃ¬nh gá»i Ä‘Ã¢y lÃ :
8/10 â€“ solid academic mini-project
Ráº¥t á»•n Ä‘á»ƒ:
â€¢	ná»™p bÃ i
â€¢	trÃ¬nh bÃ y trong lá»›p
â€¢	ghi CV má»¥c â€œprojectsâ€
________________________________________
ğŸ”¹ Level 2 â€” Professional (máº¡nh hÆ¡n 1 báº­c)
Náº¿u báº¡n thÃªm 1â€“2 Ã½ tÆ°á»Ÿng sau, Ä‘á»™ â€œxá»‹nâ€ tÄƒng rÃµ rá»‡t:
â­ TÃ¹y chá»n A: So sÃ¡nh vá»›i chiáº¿n lÆ°á»£c 1/N
(Báº¡n Ä‘Ã£ lÃ m rá»“i â€“ ráº¥t tá»‘t)
â†’ ThÃªm nháº­n xÃ©t:
â€¢	GMV giáº£m risk tháº­t khÃ´ng?
â€¢	Return cÃ³ cao hÆ¡n khÃ´ng?
â€¢	Tradeâ€“off tháº¿ nÃ o?
==> Nghe ráº¥t chuyÃªn nghiá»‡p.
________________________________________
â­ TÃ¹y chá»n B: Giá»›i háº¡n trá»ng sá»‘
VÃ­ dá»¥:
â€¢	má»—i cá»• phiáº¿u â‰¤ 30%
â€¢	khÃ´ng short
â†’ giá»‘ng portfolio real life hÆ¡n.
________________________________________
â­ TÃ¹y chá»n C: Nháº­n xÃ©t kinh táº¿ há»c
Báº¡n nÃ³i:
â€¢	diversification giÃºp giáº£m variance
â€¢	nhÆ°ng return phá»¥ thuá»™c vÃ o mean estimates
â€¢	estimation error lÃ  váº¥n Ä‘á» lá»›n cá»§a Markowitz
==> ÄÃ¢y chÃ­nh lÃ  ná»™i dung tháº§y cÃ´ muá»‘n nghe.
________________________________________
ğŸ”¹ Level 3 â€” Strong Research (ráº¥t máº¡nh)
Náº¿u báº¡n thÃªm:
ğŸ”¥ Train/Test Split (in-sample vs out-of-sample)
â€¢	train: 2015â€“2019
â€¢	test: 2020â€“nay
=> báº¡n chá»©ng minh:
Markowitz khÃ´ng chá»‰ fit quÃ¡ khá»©
mÃ  cÃ²n kiá»ƒm tra Ä‘Æ°á»£c stability
==> ÄÃ¢y lÃ  Ä‘iá»ƒm Äƒn tiá»n trong projet.
ğŸ’¯ Khi Ä‘Ã³ mÃ¬nh Ä‘Ã¡nh giÃ¡:
9.5/10 cho dá»± Ã¡n master finance
â€ƒ
############################################################
# MARKOWITZ PORTFOLIO OPTIMIZATION - EUROPEAN EQUITIES
# Version "professionnel" cho projet Master Finance / IEF
############################################################

# 0. PACKAGES ----
packages <- c("quantmod", "PerformanceAnalytics", "quadprog",
              "tidyverse", "lubridate", "scales")

installed <- rownames(installed.packages())
for(p in packages){
  if(!(p %in% installed)) install.packages(p)
}
lapply(packages, library, character.only = TRUE)

############################################################
# 1. DATA - EUROPEAN STOCKS ----
############################################################

# Chá»n má»™t táº­p cá»• phiáº¿u chÃ¢u Ã‚u "blue chips"
# (Báº¡n cÃ³ thá»ƒ thay / thÃªm mÃ£ khÃ¡c náº¿u muá»‘n)
tickers <- c("SAN.PA",   # Sanofi - France
             "OR.PA",    # L'OrÃ©al - France
             "BN.PA",    # Danone - France
             "SAP.DE",   # SAP - Germany
             "SIE.DE",   # Siemens - Germany
             "ASML.AS",  # ASML - Netherlands
             "NESN.SW",  # NestlÃ© - Switzerland
             "NOVN.SW")  # Novartis - Switzerland

start_date <- as.Date("2014-01-01")
end_date   <- Sys.Date()

# Táº£i dá»¯ liá»‡u giÃ¡ tá»« Yahoo Finance
getSymbols(Symbols = tickers,
           src = "yahoo",
           from = start_date,
           to   = end_date,
           auto.assign = TRUE,
           warnings = FALSE)

# Láº¥y giÃ¡ Adjusted Close cho má»—i cá»• phiáº¿u
prices_list <- lapply(tickers, function(sym){
  Ad(get(sym))
})

prices <- do.call(merge, prices_list)
colnames(prices) <- tickers

# XÃ³a dÃ²ng NA (do IPO, ngÃ y nghá»‰ giao dá»‹ch...)
prices <- na.omit(prices)

# TÃ­nh log-returns ngÃ y
returns <- na.omit(diff(log(prices)))
colnames(returns) <- tickers

head(returns)

############################################################
# 2. TRAIN / TEST SPLIT ----
############################################################

# VÃ­ dá»¥: 2014-2019 = TRAIN, 2020-... = TEST
train_end <- as.Date("2019-12-31")

returns_train <- returns[paste0("/", train_end)]
returns_test  <- returns[paste0(as.Date(train_end + 1), "/")]

dim(returns_train); dim(returns_test)

# Annualisation factor (252 ngÃ y giao dá»‹ch / nÄƒm)
af <- 252

# Mean vÃ  Covariance (nÄƒm hÃ³a) trÃªn máº«u TRAIN
mu_train  <- colMeans(returns_train) * af               # vector Î¼
cov_train <- cov(returns_train) * af                    # ma tráº­n Î£

n_assets <- length(tickers)

############################################################
# 3. RANDOM PORTFOLIOS (CLOUD) ----
############################################################

set.seed(123)
n_port <- 10000

random_weights <- matrix(NA, nrow = n_port, ncol = n_assets)
colnames(random_weights) <- tickers

for(i in 1:n_port){
  w <- runif(n_assets)
  w <- w / sum(w)           # chuáº©n hÃ³a sao cho âˆ‘ w = 1
  random_weights[i, ] <- w
}

# HÃ m tÃ­nh mean return & volatility cho 1 weight vector
port_return <- function(w, mu){
  as.numeric(sum(w * mu))
}

port_vol <- function(w, covmat){
  as.numeric(sqrt(t(w) %*% covmat %*% w))
}

# TÃ­nh cho toÃ n bá»™ random portfolios
rand_ret <- apply(random_weights, 1, port_return, mu = mu_train)
rand_vol <- apply(random_weights, 1, port_vol, covmat = cov_train)

random_df <- tibble(
  vol = rand_vol,
  ret = rand_ret
)

############################################################
# 4. MARKOWITZ OPTIMIZATION (GMV + FRONTIER) ----
############################################################

# Äá»ƒ trÃ¡nh lá»—i singular matrix, thÃªm chÃºt "jitter" náº¿u cáº§n
cov_posdef <- as.matrix(cov_train)
# cov_posdef <- cov_posdef + diag(1e-6, n_assets) # optional

# HÃ m tá»‘i Æ°u Markowitz: minimize w' Î£ w
# subject to: sum(w)=1, mu^T w = target_return (option), w>=0
opt_markowitz <- function(target_return = NULL){
  
  Dmat <- 2 * cov_posdef
  dvec <- rep(0, n_assets)
  
  if(is.null(target_return)){
    # Global Minimum Variance Portfolio (GMVP)
    # Constraints: sum(w) = 1 ; w >= 0
    Amat <- cbind(rep(1, n_assets), diag(n_assets))
    bvec <- c(1, rep(0, n_assets))
    meq  <- 1
  } else {
    # Frontier vá»›i constraint: sum(w)=1, mu'w = target_return, w>=0
    Amat <- cbind(rep(1, n_assets),
                  mu_train,
                  diag(n_assets))
    bvec <- c(1, target_return, rep(0, n_assets))
    meq  <- 2
  }
  
  sol <- solve.QP(Dmat = Dmat,
                  dvec = dvec,
                  Amat = Amat,
                  bvec = bvec,
                  meq  = meq)
  
  weights <- sol$solution
  names(weights) <- tickers
  return(weights)
}

# 4.1 Global Minimum Variance Portfolio
w_gmv <- opt_markowitz()
w_gmv

gmv_ret <- port_return(w_gmv, mu_train)
gmv_vol <- port_vol(w_gmv, cov_train)

# 4.2 Efficient Frontier: lá»±a target return trÃªn khoáº£ng feasible
min_mu <- min(mu_train)
max_mu <- max(mu_train)

target_seq <- seq(from = min_mu,
                  to   = max_mu,
                  length.out = 50)

frontier_list <- lapply(target_seq, function(tr){
  w <- opt_markowitz(target_return = tr)
  tibble(
    target_ret = tr,
    vol = port_vol(w, cov_train),
    ret = port_return(w, mu_train)
  )
})

frontier_df <- bind_rows(frontier_list)

############################################################
# 5. EQUAL-WEIGHT BENCHMARK (1/N) ----
############################################################

w_equal <- rep(1/n_assets, n_assets)
names(w_equal) <- tickers

eq_ret <- port_return(w_equal, mu_train)
eq_vol <- port_vol(w_equal, cov_train)

############################################################
# 6. PLOT EFFICIENT FRONTIER + RANDOM PORTFOLIOS ----
############################################################

frontier_plot <- ggplot() +
  geom_point(data = random_df,
             aes(x = vol, y = ret),
             alpha = 0.3, size = 1) +
  geom_line(data = frontier_df,
            aes(x = vol, y = ret),
            colour = "black", linewidth = 1.1) +
  geom_point(aes(x = gmv_vol, y = gmv_ret),
             colour = "darkgreen", size = 3) +
  geom_point(aes(x = eq_vol, y = eq_ret),
             colour = "blue", size = 3) +
  annotate("text", x = gmv_vol, y = gmv_ret,
           label = "GMV", vjust = -1) +
  annotate("text", x = eq_vol, y = eq_ret,
           label = "Equal-weight", vjust = -1) +
  labs(title = "Markowitz Efficient Frontier - European Equities",
       subtitle = "Random portfolios vs. Efficient Frontier (no short selling)",
       x = "Annualised volatility",
       y = "Annualised expected return") +
  scale_x_continuous(labels = percent_format(accuracy = 0.1)) +
  scale_y_continuous(labels = percent_format(accuracy = 0.1)) +
  theme_minimal()

print(frontier_plot)

############################################################
# 7. BACKTEST OUT-OF-SAMPLE (2020-... ) ----
############################################################

# HÃ m tÃ­nh performance metrics
perf_metrics <- function(port_ret, rf = 0){
  # port_ret: vector/log returns hÃ ng ngÃ y
  ann_ret <- mean(port_ret) * af
  ann_vol <- sd(port_ret) * sqrt(af)
  sharpe  <- ifelse(ann_vol == 0, NA,
                    (ann_ret - rf) / ann_vol)
  
  # ÄÆ°a sang xts Ä‘á»ƒ dÃ¹ng maxDrawdown
  port_ret_xts <- xts(port_ret, order.by = index(returns_test))
  mdd <- maxDrawdown(port_ret_xts)$maxdrawdown
  
  tibble(
    ann_return = ann_ret,
    ann_vol    = ann_vol,
    sharpe     = sharpe,
    max_dd     = mdd
  )
}

# Chuyá»ƒn returns_test -> matrix
R_test_mat <- as.matrix(returns_test)

# Returns portfolio trÃªn giai Ä‘oáº¡n TEST (log returns)
ret_gmv_test   <- as.numeric(R_test_mat %*% w_gmv)
ret_eq_test    <- as.numeric(R_test_mat %*% w_equal)

# CÃ³ thá»ƒ thÃªm 1 danh má»¥c frontier trung bÃ¬nh (vÃ­ dá»¥ target = mean(mu_train))
w_mid <- opt_markowitz(target_return = mean(mu_train))
ret_mid_test <- as.numeric(R_test_mat %*% w_mid)

# Performance metrics
perf_gmv  <- perf_metrics(ret_gmv_test)
perf_eq   <- perf_metrics(ret_eq_test)
perf_mid  <- perf_metrics(ret_mid_test)

perf_table <- bind_rows(
  GMV          = perf_gmv,
  Equal_weight = perf_eq,
  Frontier_mid = perf_mid,
  .id = "strategy"
)

perf_table

############################################################
# 8. CUMULATIVE WEALTH PLOT (OUT-OF-SAMPLE) ----
############################################################

# DÃ¹ng log returns -> wealth_t = 100 * exp(cumsum(r_t))
wealth_df <- tibble(
  date      = index(returns_test),
  GMV       = 100 * exp(cumsum(ret_gmv_test)),
  Equal     = 100 * exp(cumsum(ret_eq_test)),
  Frontier  = 100 * exp(cumsum(ret_mid_test))
)

wealth_long <- wealth_df %>%
  pivot_longer(cols = -date,
               names_to = "strategy",
               values_to = "wealth")

wealth_plot <- ggplot(wealth_long,
                      aes(x = date, y = wealth, colour = strategy)) +
  geom_line(linewidth = 1) +
  labs(title = "Out-of-sample cumulative wealth (starting at 100)",
       subtitle = "Train: 2014â€“2019, Test: 2020â€“today",
       x = "Date", y = "Wealth") +
  theme_minimal()

print(wealth_plot)

############################################################
# 9. HIá»‚N THá»Š WEIGHTS Cá»¦A CÃC DANH Má»¤C ----
############################################################

weights_df <- bind_rows(
  GMV          = as_tibble_row(round(w_gmv, 4)),
  Equal_weight = as_tibble_row(round(w_equal, 4)),
  Frontier_mid = as_tibble_row(round(w_mid, 4)),
  .id = "strategy"
)

weights_df
############################################################
# END OF SCRIPT
############################################################
â€ƒ
ğŸ“Œ Valorisation dâ€™Options EuropÃ©ennes â€” ModÃ¨le de Black-Scholes & Simulation de Monte-Carlo
ğŸ“ Master 1 MBFA â€“ IngÃ©nierie Ã‰conomique & FinanciÃ¨re
UniversitÃ© de Rennes â€” 2025-2026
Auteur : Nguyen Hoang Phuc PHAN
1. PrÃ©sentation du projet
Ce projet dÃ©veloppe un cadre complet de valorisation et de gestion du risque des options europÃ©ennes (Call & Put) reposant sur :
âœ” la formule fermÃ©e de Black-Scholes-Merton
âœ” la simulation de Monte-Carlo en mesure risque-neutre
âœ” des stratÃ©gies de couverture dynamique :
â€¢	Delta-Hedging
â€¢	Delta-Gamma Hedging
Les calculs sont rÃ©alisÃ©s Ã  partir de donnÃ©es de marchÃ© rÃ©elles du titre SociÃ©tÃ© GÃ©nÃ©rale (GLE.PA).
Lâ€™objectif dÃ©passe la simple valorisation : il consiste Ã  comprendre le risque, modÃ©liser lâ€™incertitude et mesurer la performance des stratÃ©gies de couverture dans un environnement financier rÃ©aliste.
Projet Black Scholes
2. Contenu du dÃ©pÃ´t
â€¢	TÃ©lÃ©chargement et traitement des donnÃ©es
â€¢	Fonctions de pricing Black-Scholes
â€¢	Moteur de simulation Monte-Carlo
â€¢	Calcul des Greeks
â€¢	Module de Delta-Hedging dynamique
â€¢	Module de Delta-Gamma Hedging dynamique
â€¢	Visualisations & analyses
2. Langage : 
Langage : R
Packages principaux :
quantmod
ggplot2
stats
3. Actif sous-jacent
Actif	MarchÃ©	Ticker	Raison du choix
SociÃ©tÃ© GÃ©nÃ©rale	Euronext Paris	GLE.PA	LiquiditÃ© Ã©levÃ©e et pertinence financiÃ¨re
PÃ©riode Ã©tudiÃ©e : 1 an
4. ParamÃ¨tres de marchÃ©
â€¢	VolatilitÃ© annualisÃ©e : Ïƒ = 34,97 %
â€¢	Spot actuel : S = 67,98 â‚¬
â€¢	Strike : K = 70 â‚¬
â€¢	Taux sans risque (OAT 10 ans) : r = 3,5 %
â€¢	MaturitÃ© : T = 1 an
5. Valorisation dâ€™option
5.1. RÃ©sultats Black-Scholes
RÃ©sultat	Valeur
Prix du Call	10,48 â‚¬
Prix du Put	8,16 â‚¬
âœ” Le prix du Call est croissant et convexe en fonction du spot.
5.2. Simulation Monte-Carlo
 Objectifs
(1) Visualiser la dynamique stochastique du sous-jacent
(2) Estimer la valeur thÃ©orique de lâ€™option
50 000 simulations sous mesure risque-neutre :
Indicateur	Valeur
Prix estimÃ© MC	10,4446 â‚¬
IC 95 %	[10,3350 ; 10,5543]
â¡ï¸ Convergence asymptotique vers Black-Scholes
âœ” Loi des grands nombres
âœ” TCL
6. Greeks
Greek	InterprÃ©tation	Valeur
Delta	SensibilitÃ© au spot	0,6080
Gamma	ConvexitÃ©	0,025572
Vega	SensibilitÃ© Ã  la volatilitÃ©	41,3317
Theta	DÃ©croissance temporelle	âˆ’8,3076
Rho	SensibilitÃ© au taux	30,8510
ğŸ” Points clÃ©s
âœ” forte dÃ©pendance Ã  la volatilitÃ©
âœ” convexitÃ© significative
âœ” theta nÃ©gatif (time-decay)
7. Couverture dynamique
7.1 Delta-Hedging (rÃ©Ã©quilibrage quotidien)
Principe :
â€¢	Short Call â†’ achat de Î” actions
â€¢	Auto-financement
â€¢	Ajustement quotidien
Position	PnL simulÃ©
Short Call	âˆ’0,0636 â‚¬
Long Call	+0,0636 â‚¬
ğŸ“Œ Erreur rÃ©siduelle = Gamma + discrÃ©tisation
7.2. Delta-Gamma Hedging
Ajout dâ€™une seconde option (strike 1,2K)
Position	PnL simulÃ©
Short Call	+0,0205 â‚¬
Long Call	âˆ’0,0205 â‚¬
âœ” Gamma â‰ˆ 0 sur la majeure partie de lâ€™horizon
âœ” RÃ©duction nette de lâ€™erreur de rÃ©plication
âœ” RÃ©sidu dÃ» au rÃ©Ã©quilibrage discret
8. Enseignements majeurs
â€¢	Monte-Carlo valide Black-Scholes
â€¢	Delta-Hedging supprime le risque directionnel
â€¢	Le Gamma gÃ©nÃ¨re une erreur rÃ©siduelle
â€¢	Delta-Gamma Hedging
âœ meilleure qualitÃ© de rÃ©plication
â€¢	Les coÃ»ts augmentent Ã  lâ€™approche de lâ€™Ã©chÃ©ance
9. CompÃ©tences dÃ©montrÃ©es
âœ” ModÃ©lisation stochastique
âœ” Valorisation dÃ©rivÃ©s
âœ” Mesure du risque
âœ” Traitement de donnÃ©es financiÃ¨res
âœ” ImplÃ©mentation algorithmique
âœ” Analyse critique des stratÃ©gies de couverture
ğŸ¦ Pertinent pour :
â€¢	Finance de marchÃ©
â€¢	Gestion des risques
â€¢	IngÃ©nierie financiÃ¨re
â€¢	Quantitative analysis
10. Pistes dâ€™amÃ©lioration
ğŸ”¹ volatilitÃ© stochastique (Heston)
ğŸ”¹ sauts (Merton)
ğŸ”¹ options amÃ©ricaines (LSM)
ğŸ”¹ surface de volatilitÃ©
ğŸ”¹ coÃ»ts de transaction
ğŸ”¹ calibration empirique
 Auteur
Nguyen Hoang Phuc PHAN
Master 1 â€“ MBFA
UniversitÃ© de Rennes (France)


